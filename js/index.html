<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrSS Example</title>
    <script>
        const MAX_ENTRIES = 30;
        
        function repeatArray(arr, count) { 
            let result = []; 
            for (let i = 0; i < count; i++) { 
                result = result.concat(arr); 
            } 
            return result; 
        }

        class PrSS {
            constructor(array) {
                if (!Array.isArray(array)) {
                    throw new TypeError(`Expected list type for PrSS(), not ${typeof array}`);
                }

                this.sequence = array.slice();
                for (let i = 0; i < this.sequence.length; i++) {
                    if (typeof this.sequence[i] !== 'number') {
                        throw new TypeError(`Expected int type for array[${i}], not ${typeof this.sequence[i]}`);
                    }
                }

                if (this.sequence.length === 0) {
                    return;
                }

                let last = -1;
                for (const value of this.sequence) {
                    if (value > (last + 1)) {
                        throw new Error(`Invalid PrSS: ${this.sequence}`);
                    }
                    last = value;
                }
            }

            toString() {
                return this.sequence.map(item => `(${item})`).join('');
            }

            eval(base = 3) {
                if (this.sequence.length === 0) {
                    throw new Error("Cannot evaluate an empty sequence.");
                }

                if (this.sequence[this.sequence.length - 1] === 0) {
                    const s = this.sequence.slice(0, -1);
                    return new PrSS(s);
                }

                const bad = this.sequence[this.sequence.length - 1];
                let s = [];
                for (let i = this.sequence.length - 2; i >= 0; i--) {
                    s.unshift(this.sequence[i]);
                    if (this.sequence[i] < bad) {
                        const t = this.sequence.slice(0, i);
                        return new PrSS(t.concat(repeatArray(s, base + 1)));
                    }
                }
                return new PrSS(repeatArray(s, base));
            }
        }

        function usePrSS() {
            const input = document.getElementById('sequenceInput').value;
            const base = parseInt(document.getElementById('base').value);
            try {
                const sequence = input.match(/\d+/g).map(Number);
                const prssInstance = new PrSS(sequence);
                document.getElementById('provided').textContent = prssInstance.toString();
                let currentPrSS = prssInstance;
                let len = currentPrSS.sequence.length;
                document.getElementById('output').innerHTML = '';
                while (len < MAX_ENTRIES && currentPrSS.toString !== '') {
                    currentPrSS = prssInstance.eval(base);
                    len = currentPrSS.sequence.length;
                    document.getElementById('output').innerHTML += '<br>'.concat(currentPrSS.toString());
                }
            } catch (error) {
                console.error(error);
                document.getElementById('output').textContent = `Error: ${error.message}`;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('sequenceInput').value = '(0)(1)(2)';
            document.querySelector('button').addEventListener('click', usePrSS);
        });
    </script>
</head>
<body>
    <h1>PrSS Example</h1>
    <label for="sequenceInput">Enter sequence (e.g., (0)(1)(2)):</label>
    <input type="text" id="sequenceInput" value="(0)(1)(2)"><br>
    <label for="base">Base:</label>
    <input type="number" id="base" value="3">
    <button>Submit</button>
    <div id="provided"></div><br>
    <div id="output"></div>
</body>
</html>
